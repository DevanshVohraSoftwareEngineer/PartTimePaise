# PartTimePaise - Task Marketplace Schema
# Integrated with Firebase Auth for user management

# User table is keyed by Firebase Auth UID
type User @table {
  # Firebase Auth UID as primary key
  id: String! @default(expr: "auth.uid")
  email: String!
  name: String!
  role: String! # 'client' or 'worker'
  avatarUrl: String
  bio: String
  latitude: Float
  longitude: Float
  city: String
  phone: String
  rating: Float @default(expr: "0.0")
  verified: Boolean @default(expr: "false")
  walletBalance: Float @default(expr: "0.0")
  college: String
  completedTasks: Int @default(expr: "0")
  skills: [String!] # Array of skills for workers
  createdAt: Date! @default(expr: "request.time")
  updatedAt: Date! @default(expr: "request.time")

  # Relationships (auto-generated)
  # tasks_posted: [Task!]! - tasks posted by this user
  # bids_placed: [Bid!]! - bids placed by this user
  # matches_as_worker: [TaskMatch!]! - matches where user is worker
  # matches_as_client: [TaskMatch!]! - matches where user is client
}

# Task table for job postings
type Task @table {
  # Auto-generated UUID
  id: UUID! @default(expr: "uuidV4()")
  title: String!
  description: String!
  category: String!
  budget: Float!
  budgetType: String @default(expr: "'fixed'") # 'fixed' or 'hourly'
  deadline: Date
  urgency: String @default(expr: "'medium'") # 'low', 'medium', 'high'
  client: User! # Foreign key to User
  status: String! @default(expr: "'open'") # 'open', 'inProgress', 'completed', 'cancelled'
  latitude: Float
  longitude: Float
  location: String
  imageUrl: String
  images: [String!] # Array of image URLs
  createdAt: Date! @default(expr: "request.time")
  updatedAt: Date! @default(expr: "request.time")

  # Relationships (auto-generated)
  # bids_on_task: [Bid!]! - bids on this task
  # matches_for_task: [TaskMatch!]! - matches for this task
}

# Bid table for worker applications
type Bid @table {
  id: UUID! @default(expr: "uuidV4()")
  task: Task! # Foreign key to Task
  worker: User! # Foreign key to User
  amount: Float!
  message: String!
  status: String! @default(expr: "'pending'") # 'pending', 'accepted', 'rejected'
  createdAt: Date! @default(expr: "request.time")
  updatedAt: Date! @default(expr: "request.time")
}

# TaskMatch table for successful matches
type TaskMatch @table(key: ["task", "worker"]) {
  id: UUID! @default(expr: "uuidV4()")
  task: Task! # Foreign key to Task
  worker: User! # Foreign key to User
  client: User! # Foreign key to User (redundant but useful)
  status: String! @default(expr: "'active'") # 'active', 'completed', 'cancelled'
  matchedAt: Date! @default(expr: "request.time")

  # Relationships (auto-generated)
  # messages_in_match: [Message!]! - messages in this match
}

# Message table for chat functionality
type Message @table {
  id: UUID! @default(expr: "uuidV4()")
  matchId: UUID! # Foreign key to TaskMatch.id
  senderId: String! # Foreign key to User.id (Firebase Auth UID)
  content: String!
  messageType: String @default(expr: "'text'") # 'text', 'image', 'file'
  read: Boolean @default(expr: "false")
  createdAt: Date! @default(expr: "request.time")
}

# Notification table for push notifications
type Notification @table {
  id: UUID! @default(expr: "uuidV4()")
  user: User! # Foreign key to User
  title: String!
  message: String!
  type: String! # 'bid_received', 'bid_accepted', 'task_completed', etc.
  read: Boolean @default(expr: "false")
  data: String # JSON string for additional data
  createdAt: Date! @default(expr: "request.time")
}

# Payment table for transaction tracking
type Payment @table {
  id: UUID! @default(expr: "uuidV4()")
  taskMatchId: UUID! # Foreign key to TaskMatch.id
  amount: Float!
  status: String! @default(expr: "'pending'") # 'pending', 'completed', 'failed'
  paymentMethod: String # 'wallet', 'card', 'upi', etc.
  transactionId: String
  createdAt: Date! @default(expr: "request.time")
  completedAt: Date
}
